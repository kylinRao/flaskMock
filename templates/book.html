{% extends "layout.html" %}
{% block body %}


    <html>
    <head>
        <meta charset="UTF-8">
        <title>Document</title>
        <style type="text/css">
            .lightbox {
                position: fixed;
                top: 0px;
                left: 0px;
                height: 100%;
                width: 100%;
                z-index: 7;
                opacity: 1;
                display: block;
                background-color: rgb(138, 138, 138);
                display: none;
            }

            .pop, iframe {
                position: absolute;
                left: 0%;
                top: 0;
                width: 893px;
                height: 100%;
                margin-left: 0px;
                z-index: 9;
            }
        </style>
        <script src="/static/js/pdf.js" type="text/javascript"></script>
        {#    测试代码#}
        <script src="/static/js/jquery-2.0.0.min.js"></script>


        <script type="text/javascript">

            $(function () {
                $("#toggle").click(function () {
                    $(this).text($("#content").is(":hidden") ? "收起评论" : "展开评论");
                    $("#content").slideToggle();
                });
            });

        </script>
        <script type="text/javascript">
            function showPdf(isShow, bookid) {
                var state = "";
                if (isShow) {
                    state = "block";
                } else {
                    state = "none";
                }
                var pop = document.getElementById("pop");
                pop.style.display = state;
                var lightbox = document.getElementById("lightbox");
                lightbox.style.display = state;


            }
            function close() {
                showPdf(false);
            }
        </script>

    </head>
    <body>


    <ul>
        {% for fileentry in filesList %}
            <li><a href={{ fileentry.path }} target="pdfContainer"
                   onclick="showPdf(true,{{ fileentry.id }})">{{ fileentry.bookName }}</a></li>
        {% endfor %}
    </ul>
    <div class="lightbox" id="lightbox"></div>
    <div id="pop" class="pop" style="display: none;">
        <a href="javascript:close()" style="
            position: absolute;
            right: -90px;
            display: inline-block;
            width: 80px;
            height: 30px;
        " id="close">关闭</a>
        <iframe src="" frameborder="0" id="pdfContainer" name="pdfContainer"></iframe>

        <div style="
                position: absolute;
                right:-300px;
                top: 40px;
                display: inline-block;
                width: 280px;
                height: 30px;
            ">

            <a id="toggle">隐藏评论</a>
            <div id="content">
                <form id="commentForm" action="" method=post class=add-entry onsubmit="return false;">
                    <dl>
                        <dt>评论信息:
                            <textarea name=commentAdd rows=5 cols=40></textarea>
                         <input type="button" id="addComment" value="share" onclick="addComment">


                    </dl>
                </form>



                <div id="commentsContent">
                    {#                评论信息展示#}
                    {% for entry in entries %}
                        <div style="float: left" class="commentsDetail"><a
                                style="color: black">{{ entry.comment|safe }} </a>
                        </div>
                        <div style="float: none" class="delete">
                            <a href="{{ url_for('commentDelete',post_id=entry.id) }} ">delete</a>
                        </div>

                    {% endfor %}
                </div>
            </div>
        </div>


    </div>


    <script>

        String.prototype.format = function () {
            var args = arguments;
            var reg = /\{(\d+)\}/g;
            return this.replace(reg, function (g0, g1) {
                return args[+g1];
            });
        };


        $('#addComment').click(function () {

            var url = "/add_comment_json";
            console.log("message:" + $("textarea").val());

            if ("" == $("textarea").val()) {
                alert("评论信息不能为空！");
            }
            else {

                $.ajax({
                    url: url,
                    type: 'post',
                    dateType: 'json',
                    data: $("#commentForm").serialize(),
                    success: function (data) {
                        console.log(data);
                        console.log(eval(data));
                        //刷新评论区
                        var entry = {};


                        eval(data).forEach(function (entry, index) {
                            console.log(entry);

                            var appendcontent =
                                ' <div style="float: left" class="commentsDetail"><astyle="color: black">{0}</a></div>'.format(entry.comment)
                                + '<div style="float: none" class="delete">' +
                                '<a href="/commentDelete/{0}">delete</a>'.format(entry.id);


                            {#                        $("#content").append('<p>{0}</p> '.format(entry.comment));#}
                            $("#commentsContent").prepend(appendcontent);

                        });


                    },
                    error: function () {
                        alert("error!");
                    }

                });
            }

        });


    </script>


    </body>
    </html>

{% endblock %}